<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forvia Cikkszám kereső G.R 2026</title>

<style>
body {
font-family: Arial, Helvetica, sans-serif;
margin: 0;
padding: 15px;
background: #f7f7f7;
}
h2 { margin-top: 0; }
input { width: 100%; font-size: 20px; padding: 10px; box-sizing: border-box; }
.card { background: white; margin-top: 12px; padding: 12px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.15); }
.label { font-weight: bold; }

/* --- Címek kiemelése --- */
.bank-title strong {
color: #1565c0;
background: #e3f2fd;
padding: 6px;
border-left: 6px solid #1976d2;
display: block;
border-radius: 4px;
margin-bottom: 6px;
}

.ultetes-title strong {
color: #2e7d32;
background: #e8f5e9;
padding: 6px;
border-left: 6px solid #2e7d32;
display: block;
border-radius: 4px;
margin-bottom: 6px;
}

/* --- Autocomplete --- */
#javaslatok {
background: white;
border-radius: 6px;
box-shadow: 0 1px 3px rgba(0,0,0,0.15);
margin-top: 5px;
}

.javaslat {
padding: 10px;
cursor: pointer;
border-bottom: 1px solid #eee;
}

.javaslat:last-child {
border-bottom: none;
}

.javaslat:hover {
background: #f0f0f0;
}
</style>
</head>

<body>

<h2>Forvia Cikkszám kereső G.R 2026</h2>

<input
id="keres"
type="text"
placeholder="Keress rá egy cikkszámra!"
disabled
/>

<div id="javaslatok"></div>
<div id="eredmeny">Adatok betöltése…</div>

<script>
let bank = [];
let ultetes = [];
let keresIdozito = null;

/* ===== CSV-k betöltése ===== */
Promise.all([
fetch('bank.csv?ver=FINAL1').then(r => r.text()),
fetch('ultetes.csv?ver=FINAL1').then(r => r.text())
]).then(([bankText, ultetesText]) => {

bank = feldolgoz(bankText);
ultetes = feldolgoz(ultetesText);

document.getElementById('keres').disabled = false;
document.getElementById('eredmeny').innerHTML = '';

document.getElementById('keres').addEventListener('input', function () {
clearTimeout(keresIdozito);
keresIdozito = setTimeout(keres.bind(this), 250);
});
});

/* ===== CSV feldolgozás ===== */
function feldolgoz(text) {
return text
.split('\n')
.map(s => s.replace(/"/g, '').trim())
.filter(s => s.length > 0)
.slice(1)
.map(s => s.split(';').map(e => e.trim()));
}

/* ===== AUTOCOMPLETE ===== */
function frissitJavaslatok(keresett) {
const javaslatDiv = document.getElementById('javaslatok');
javaslatDiv.innerHTML = '';

if (keresett.length < 2) return;

const cikkszamok = new Set();
bank.forEach(r => r[2] && cikkszamok.add(r[2]));
ultetes.forEach(r => r[0] && cikkszamok.add(r[0]));

[...cikkszamok]
.filter(c => c.toLowerCase().startsWith(keresett))
.slice(0, 8)
.forEach(c => {
const div = document.createElement('div');
div.className = 'javaslat';
div.textContent = c;
div.onclick = () => {
document.getElementById('keres').value = c;
javaslatDiv.innerHTML = '';
keres.call(document.getElementById('keres'));
};
javaslatDiv.appendChild(div);
});
}

/* ===== KERESÉS ===== */
function keres() {
const keresett = this.value.trim().toLowerCase();
let html = '';

frissitJavaslatok(keresett);

if (keresett.length < 2) {
document.getElementById('eredmeny').innerHTML = '';
return;
}

/* ===== BANK ===== */
const bankTalalat = bank.filter(r =>
r[2] && r[2].toLowerCase().includes(keresett)
);

if (bankTalalat.length > 0) {
html += `<div class="card bank-title"><strong>Feeder bank adatok</strong></div>`;
bankTalalat.forEach(r => {
html += `
<div class="card">
<div><span class="label">Cikkszám:</span> ${r[2]}</div>
<div><span class="label">Gép:</span> ${r[0]}</div>
<div><span class="label">Pozíció:</span> ${r[1]}</div>
<div><span class="label">Model:</span> ${r[3]}</div>
</div>
`;
});
}

/* ===== ÜLTETÉS ===== */
const ultetesTalalat = ultetes.filter(r =>
r[0] && r[0].toLowerCase().includes(keresett)
);

ultetesTalalat.sort((a, b) => parseInt(b[5]) - parseInt(a[5]));

if (ultetesTalalat.length > 0) {
html += `<div class="card ultetes-title"><strong>Beültetés és alkatrész adatok</strong></div>`;
ultetesTalalat.forEach(r => {
html += `
<div class="card">
<div><span class="label">Cikkszám:</span> ${r[0]}</div>
<div><span class="label">Alkatrész info:</span> ${r[1]}</div>
<div><span class="label">Oldal:</span> ${r[3]}</div>
<div><span class="label">Modell:</span> ${r[4]}</div>
<div><span class="label">Beültetés db:</span> ${r[5]}</div>
</div>
`;
});
}

if (bankTalalat.length === 0 && ultetesTalalat.length === 0) {
html = `<div class="card">Nincs találat erre a cikkszámra</div>`;
}

document.getElementById('javaslatok').innerHTML = '';
document.getElementById('eredmeny').innerHTML = html;
}
</script>

</body>
</html>
